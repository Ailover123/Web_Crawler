{% extends "layout.html" %}
{% block title %}Alert Detail{% endblock %}

{% block content %}
<h2>Alert Detail</h2>

<div class="dashboard-section">
    <h3>Alert Information</h3>
    <table class="data-table">
        <tbody>
            <tr>
                <td><strong>URL:</strong></td>
                <td>{{ alert.url }}</td>
            </tr>
            <tr>
                <td><strong>Severity:</strong></td>
                <td>{{ alert.severity }}</td>
            </tr>
            <tr>
                <td><strong>Status:</strong></td>
                <td>{{ alert.status }}</td>
            </tr>
            <tr>
                <td><strong>Detected At:</strong></td>
                <td>{{ alert.detected_at_ist or alert.detected_at }}</td>
            </tr>
            <tr>
                <td><strong>Baseline Hash:</strong></td>
                <td>{{ alert.baseline_hash }}</td>
            </tr>
            <tr>
                <td><strong>Observed Hash:</strong></td>
                <td>{{ alert.observed_hash }}</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="dashboard-section">
    <h3>Defacement Analysis</h3>
    <p><strong>Why is this flagged as defacement?</strong></p>
    <p>This alert was triggered because the observed HTML content hash ({{ alert.observed_hash }}) differs from the baseline hash ({{ alert.baseline_hash }}). This indicates that the website content has changed since the baseline was established.</p>

    <p><strong>What changed?</strong></p>
    <p>The diff summary below shows the specific changes detected between the baseline and observed content:</p>

    <pre class="pre-diff-summary">{{ alert.diff_summary_pretty }}</pre>

    <p><strong>Recommended Actions:</strong></p>
    <ul>
        <li>Verify if this change was authorized</li>
        <li>Check the website for signs of compromise</li>
        <li>Review server logs for suspicious activity</li>
        <li>Update baseline if change is legitimate</li>
    </ul>
</div>

<div class="dashboard-section">
    <h3>Code Comparison</h3>

    <div class="code-comparison-container">
        <!-- Baseline Code -->
        <div class="code-panel">
            <h4>Baseline Code (Original)</h4>
            <div class="code-scroll">
                <pre class="code-content">{{ baseline_html|safe }}</pre>
            </div>
        </div>

        <!-- Observed Code -->
        <div class="code-panel">
            <h4>Observed Code (Current)</h4>
            <div class="code-scroll">
                <pre class="code-content">{{ observed_html|safe }}</pre>
            </div>
        </div>
    </div>
</div>

<div class="center-section">
    <a href="/alerts" class="back-button">Back to Alerts</a>
</div>
{% endblock %}
